!function(){"use strict";angular.module("app.login",[]).run(function($rootScope,$location,UserFacebookID){$rootScope.$on("$routeChangeStart",function(event,next){var current=$location.path();console.log("step 1... about to authenticate - toState: "+current+" logged: "+UserFacebookID.logged),0==UserFacebookID.logged&&("/pages/signin"==current||(console.log("step 2... save current state "+current),UserFacebookID.scopeState=current,console.log("step 3... jump to login  "+UserFacebookID.scopeState),$location.path("/pages/signin"),event.preventDefault()))})}).controller("loginCtrl",["$rootScope","$scope","$timeout","$window","Facebook","UserFacebookID",function($rs,$scope,$timeout,$window,Facebook,UserFacebookID){console.log("heloo wombath codes - inside LoginCtrl"),$scope.user={},$scope.logged=!1,$scope.byebye=!1,$scope.salutation=!1,$scope.$watch(function(){return Facebook.isReady()},function(newVal){newVal&&($scope.facebookReady=!0)});var userIsConnected=!1;Facebook.getLoginStatus(function(response){"connected"==response.status&&(userIsConnected=!0)}),$scope.IntentLogin=function(){userIsConnected||$scope.login()};var refreshProjectList=function(){console.log("/////>>>> refreshProjectList in emit"),$scope.$emit("refreshProjectList",{})};$scope.login=function(){console.log("step 4... starting the facebook login"),Facebook.login(function(response){"connected"==response.status&&($scope.logged=!0,UserFacebookID.logged=!0,$scope.me(),console.log("step 5... jumping to the previus state"),"index"!=UserFacebookID.scopeState&&$location.path(UserFacebookID.scopeState))})},$scope.me=function(){Facebook.api("/me",function(response){console.log("step 6... adding the user info"),$scope.$apply(function(){$scope.user=response,UserFacebookID.user=response,console.log("cookie >> step 1... adding the user info to cookie"),console.log("1. send the current user to sever"),console.log(UserFacebookID.user),refreshProjectList()})})},$scope.logout=function(){Facebook.logout(function(){$scope.$apply(function(){$scope.user={},$scope.logged=!1,UserFacebookID.user={},UserFacebookID.logged=!1,userIsConnected=!1,$location.path("/pages/signin")})})},$scope.$on("Facebook:statusChange",function(ev,data){console.log("Status: ",data),"connected"==data.status?$scope.$apply(function(){$scope.salutation=!0,$scope.byebye=!1,$scope.logged=!0,UserFacebookID.logged=!0,refreshProjectList()}):$scope.$apply(function(){$scope.salutation=!1,$scope.byebye=!0,$timeout(function(){$scope.byebye=!1},2e3)})})}])}();